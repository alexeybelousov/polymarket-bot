<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Logs</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&display=swap');
    :root { --bg: #0a0a0f; --bg2: #12121a; --bg3: #1a1a24; --border: #2a2a3a; --text: #e4e4e7; --text2: #71717a; --green: #22c55e; --green-dim: rgba(34, 197, 94, 0.15); --red: #ef4444; --red-dim: rgba(239, 68, 68, 0.15); --blue: #3b82f6; }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'JetBrains Mono', monospace; background: var(--bg); color: var(--text); min-height: 100vh; }
    .container { max-width: 1400px; margin: 0 auto; padding: 16px; }
    header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 12px; border-bottom: 1px solid var(--border); }
    h1 { font-size: 18px; font-weight: 600; }
    .nav-link { color: var(--text2); text-decoration: none; padding: 4px 8px; border-radius: 4px; font-size: 12px; }
    .nav-link:hover { color: var(--text); background: var(--bg2); }
    .filters { display: flex; gap: 8px; margin-bottom: 16px; flex-wrap: wrap; }
    .filter-btn { padding: 6px 12px; background: var(--bg2); border: 1px solid var(--border); border-radius: 6px; color: var(--text2); font-size: 11px; font-family: inherit; cursor: pointer; }
    .filter-btn:hover, .filter-btn.active { background: var(--bg3); color: var(--text); border-color: var(--blue); }
    .logs-table { width: 100%; border-collapse: collapse; background: var(--bg2); border-radius: 10px; overflow: hidden; }
    .logs-table th { text-align: left; padding: 12px 14px; font-size: 10px; font-weight: 600; color: var(--text2); background: var(--bg3); border-bottom: 1px solid var(--border); }
    .logs-table td { padding: 10px 14px; font-size: 12px; border-bottom: 1px solid var(--border); }
    .logs-table tr:hover { background: var(--bg3); }
    .badge { padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: 600; }
    .badge.detect { background: var(--green-dim); color: var(--green); }
    .badge.skip { background: var(--bg); color: var(--text2); }
    .badge.send { background: rgba(59, 130, 246, 0.15); color: var(--blue); }
    .badge.error { background: var(--red-dim); color: var(--red); }
    .badge.trade { background: rgba(234, 179, 8, 0.15); color: #eab308; }
    .pagination { display: flex; justify-content: center; align-items: center; gap: 8px; padding: 16px; }
    .page-btn { padding: 6px 12px; background: var(--bg2); border: 1px solid var(--border); border-radius: 6px; color: var(--text); font-size: 12px; font-family: inherit; cursor: pointer; }
    .page-btn:hover:not(:disabled) { background: var(--bg3); border-color: var(--blue); }
    .page-btn:disabled { opacity: 0.4; cursor: not-allowed; }
    .page-info { font-size: 12px; color: var(--text2); }
    .empty { text-align: center; padding: 40px; color: var(--text2); }
  </style>
</head>
<body>
  <div class="container">
    <header><h1>üìù Logs</h1><a href="/dashboard" class="nav-link">‚Üê Dashboard</a></header>
    <div class="filters">
      <button class="filter-btn active" data-filter="all">–í—Å–µ</button>
      <button class="filter-btn" data-filter="detect">‚úÖ Detect</button>
      <button class="filter-btn" data-filter="trade">üí∞ Trade</button>
      <button class="filter-btn" data-filter="send">üì§ Send</button>
      <button class="filter-btn" data-filter="error">‚ùå Error</button>
      <select id="botFilter" style="padding: 6px 12px; background: var(--bg2); border: 1px solid var(--border); border-radius: 6px; color: var(--text); font-size: 11px; font-family: inherit; cursor: pointer;">
        <option value="">–í—Å–µ –±–æ—Ç—ã</option>
      </select>
      <span style="font-size: 11px; color: var(--text2); display: flex; justify-content: center; align-items: center; margin-left: 8px;">–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ: <span id="updateTime">‚Äî</span></span>
    </div>
    <table class="logs-table">
      <thead><tr><th>–í—Ä–µ–º—è</th><th>–ë–æ—Ç</th><th>–¢–∏–ø</th><th>–†—ã–Ω–æ–∫</th><th>–î–µ–π—Å—Ç–≤–∏–µ</th><th>–ü—Ä–∏—á–∏–Ω–∞</th></tr></thead>
      <tbody id="logsBody"><tr><td colspan="6" class="empty">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr></tbody>
    </table>
    <div class="pagination">
      <button class="page-btn" id="prevPage" disabled>‚Üê –ù–∞–∑–∞–¥</button>
      <span class="page-info" id="pageInfo">1 / 1</span>
      <button class="page-btn" id="nextPage">–í–ø–µ—Ä—ë–¥ ‚Üí</button>
    </div>
  </div>
  <script>
    let page = 1, filter = 'all', botFilter = '', pages = 1;
    let allBots = [];
    
    function formatTime(d) { return new Date(d).toLocaleString('ru-RU', { day: '2-digit', month: '2-digit', hour: '2-digit', minute: '2-digit', second: '2-digit' }); }
    
    async function loadBots() {
      try {
        const res = await fetch('/api/trading/bots');
        allBots = await res.json();
        const selectEl = document.getElementById('botFilter');
        if (selectEl) {
          allBots.forEach(bot => {
            const option = document.createElement('option');
            option.value = bot.botId;
            option.textContent = bot.name;
            selectEl.appendChild(option);
          });
          selectEl.onchange = () => { botFilter = selectEl.value; page = 1; load(); };
        }
      } catch(e) { console.error(e); }
    }
    
    async function load() {
      const params = new URLSearchParams({ page, limit: 50 });
      if (filter !== 'all') params.set('action', filter);
      if (botFilter) params.set('botId', botFilter);
      const res = await fetch(`/api/logs?${params}`);
      const data = await res.json();
      pages = data.pagination.pages || 1;
      const tbody = document.getElementById('logsBody');
      if (!data.logs.length) { tbody.innerHTML = '<tr><td colspan="6" class="empty">–ù–µ—Ç –ª–æ–≥–æ–≤</td></tr>'; }
      else {
        tbody.innerHTML = data.logs.map(l => {
          const bot = allBots.find(b => b.botId === l.botId);
          const botName = bot ? bot.name : (l.botId || 'bot1');
          return `<tr>
            <td>${formatTime(l.timestamp)}</td>
            <td style="font-size: 10px; color: var(--text2);">${botName}</td>
            <td>${l.type.toUpperCase()}</td>
            <td title="${l.marketSlug}">${l.marketSlug.split('-').pop()}</td>
            <td><span class="badge ${l.action}">${l.action}</span></td>
            <td>${l.reason || '‚Äî'}</td>
          </tr>`;
        }).join('');
      }
      document.getElementById('pageInfo').textContent = `${page} / ${pages}`;
      document.getElementById('prevPage').disabled = page <= 1;
      document.getElementById('nextPage').disabled = page >= pages;
      document.getElementById('updateTime').textContent = formatTime(new Date());
    }
    document.querySelectorAll('.filter-btn').forEach(btn => { btn.onclick = () => { document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active')); btn.classList.add('active'); filter = btn.dataset.filter; page = 1; load(); }; });
    document.getElementById('prevPage').onclick = () => { if (page > 1) { page--; load(); } };
    document.getElementById('nextPage').onclick = () => { if (page < pages) { page++; load(); } };
    loadBots();
    load(); setInterval(load, 10000);
  </script>
</body>
</html>

